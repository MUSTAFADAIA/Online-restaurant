<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
    />
    <link rel="stylesheet" href="./css/css.css" />

    <title>Restaurant</title>
  </head>
  <body>
    <header>
      <a href="#" class="logo"><i class="fas fa-utensils"></i>food</a>
      <div id="menu-bar" class="fas fa-bars"></div>

      <nav class="navbar">
        <a href="#home">home</a>
        <a href="#speciality">speciality</a>
        <a href="#popular">popular</a>
        <a href="#gallery">gallery</a>
        <a href="#review">review</a>
        <a href="login.html" class="logout-link">Logout</a>
        <a href="cart.html" class="cart-icon">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-count" id="cart-count">0</span>
        </a>
      </nav>
    </header>

    <section class="home" id="home">
      <div class="content">
        <h3>food made with love</h3>
        <p>
          Lorem ipsum dolor sit amet consectetur, adipisicing elit. Delectus in
          excepturi voluptate, placeat atque corporis ratione asperiores
          consectetur, odit quibusdam unde earum reiciendis enim autem soluta
          fugiat dolorem aperiam pariatur.
        </p>
        <a href="#" class="btn">order now</a>
      </div>

      <div class="image">
        <img
          src="./image/delicious-burger-with-many-ingredients-isolated-white-background-tasty-cheeseburger-splash-sauce-removebg-preview.png"
          alt=""
        />
      </div>
    </section>
    <section class="speciality" id="speciality">
      <h1 class="heading">our <span>speciality</span></h1>
      <div class="box-container">
        <div class="box">
          <img
            class="image"
            src="./image/photo-delicious-hamburger-isolated-white-background-removebg-preview.png"
            alt=""
          />
          <div class="content">
            <img src="image/burger_1161644-removebg-preview.png" alt="" />
            <h3>tasty burger</h3>
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Aperiam
              eos, consectetur officiis velit totam cupiditate debitis dolores
              nihil vel iste sunt magni sed fuga nemo similique ea eveniet
              dolorum eius.
            </p>
          </div>
        </div>
        <div class="box">
          <img
            class="image"
            src="./image/0276f102-304d-4a62-90b3-ec9a942e5b36-removebg-preview.png"
            alt=""
          />
          <div class="content">
            <img src="image/pizza_5045374-removebg-preview.png" alt="" />
            <h3>tasty pizza</h3>
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Aperiam
              eos, consectetur officiis velit totam cupiditate debitis dolores
              nihil vel iste sunt magni sed fuga nemo similique ea eveniet
              dolorum eius.
            </p>
          </div>
        </div>

        <div class="box">
          <img
            class="image"
            src="./image/Tasty_crunchy_walnuts_ice_cream_-15-removebg-preview.png"
            alt=""
          />
          <div class="content">
            <img src="image/shaved-ice_3948375-removebg-preview.png" alt="" />
            <h3>cold ice-cream</h3>
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Aperiam
              eos, consectetur officiis velit totam cupiditate debitis dolores
              nihil vel iste sunt magni sed fuga nemo similique ea eveniet
              dolorum eius.
            </p>
          </div>
        </div>

        <div class="box">
          <img
            class="image"
            src="./image/istockphoto-655123574-612x612.jpg"
            alt=""
          />
          <div class="content">
            <img src="image/lemonade_10689258-removebg-preview.png" alt="" />
            <h3>cold drinks</h3>
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Aperiam
              eos, consectetur officiis velit totam cupiditate debitis dolores
              nihil vel iste sunt magni sed fuga nemo similique ea eveniet
              dolorum eius.
            </p>
          </div>
        </div>

        <div class="box">
          <img class="image" src="./image/sweet.jpg" alt="" />
          <div class="content">
            <img src="image/donut_1791078-removebg-preview.png" alt="" />
            <h3>tasty sweets</h3>
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Aperiam
              eos, consectetur officiis velit totam cupiditate debitis dolores
              nihil vel iste sunt magni sed fuga nemo similique ea eveniet
              dolorum eius.
            </p>
          </div>
        </div>
        <div class="box">
          <img class="image" src="./image/29391.jpg" alt="" />
          <div class="content">
            <img src="image/breakfast_10784323-removebg-preview.png" alt="" />
            <h3>healty breakfast</h3>
            <p>
              Lorem ipsum dolor sit amet consectetur adipisicing elit. Aperiam
              eos, consectetur officiis velit totam cupiditate debitis dolores
              nihil vel iste sunt magni sed fuga nemo similique ea eveniet
              dolorum eius.
            </p>
          </div>
        </div>
      </div>
    </section>
    <section class="popular" id="popular">
      <h1 class="heading">most <span>popular</span> foods</h1>
      <div class="box-container" id="category-container"></div>
    </section>

    <section class="review" id="review">
      <h1>our customers <span>reviews</span></h1>
      <div class="box-container" id="reviews-container"></div>

      <button id="add-review-btn" class="btn add-btn">Add a comment</button>

      <div id="review-form-container" class="form-wrapper hidden">
        <h3 id="form-title">Add a comment</h3>
        <form id="review-form" class="review-form">
          <input type="hidden" id="review-id" />
          <input
            type="text"
            id="reviewer-name"
            placeholder="Your Name"
            required
          />
          <textarea
            id="review-text"
            rows="4"
            placeholder="Your Comment"
            required
          ></textarea>
          <div class="form-actions">
            <button type="submit" class="btn submit-btn">Save</button>
            <button type="button" id="cancel-btn" class="btn cancel-btn">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </section>

    <section class="footer">
      <div class="share">
        <a href="" class="btn">facebook</a>
        <a href="" class="btn">twitter</a>
        <a href="" class="btn">instagram</a>
        <a href="" class="btn">pinterest</a>
        <a href="" class="btn">linkedin</a>
      </div>
      <h1 class="credit"></h1>
    </section>

    <a href="#" class="fas fa-angle-up" id="scroll-top"></a>
  </body>
  <script>
    const reviewsContainer = document.getElementById("reviews-container");
    const addBtn = document.getElementById("add-review-btn");
    const formContainer = document.getElementById("review-form-container");
    const reviewForm = document.getElementById("review-form");
    const formTitle = document.getElementById("form-title");
    const cancelBtn = document.getElementById("cancel-btn");
    const reviewerNameInput = document.getElementById("reviewer-name");
    const reviewTextInput = document.getElementById("review-text");
    const reviewIdInput = document.getElementById("review-id");

    let editingId = null;

    async function fetchApiReviews() {
      try {
        const token = localStorage.getItem("token");
        const response = await fetch("http://localhost:5000/api/v2/comment", {
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json",
          },
        });

        const data = await response.json();
        reviewsContainer.innerHTML = "";

        data.data.forEach((rev) => {
          const box = document.createElement("div");
          box.className = "box";
          box.dataset.id = rev._id;

          box.innerHTML = `
          <h3>${rev.name}</h3>
          <p>${rev.comment}</p>
          <div class="actions" style="margin-top:10px;">
            ${
              rev.user === localStorage.getItem("id")
                ? `
              <button class="edit-btn">Update</button>
              <button class="delete-btn">Delete</button>
            `
                : ""
            }
          </div>
        `;

          reviewsContainer.appendChild(box);

          if (rev.user === localStorage.getItem("id")) {
            attachActions(box);
          }
        });
      } catch (err) {
        console.error("Comments could not be loaded:", err);
      }
    }

    function attachActions(box) {
      const editBtn = box.querySelector(".edit-btn");
      const deleteBtn = box.querySelector(".delete-btn");

      if (editBtn) {
        editBtn.addEventListener("click", () => {
          editingId = box.dataset.id;
          formTitle.textContent = "Edit comment";
          reviewerNameInput.value = box.querySelector("h3").textContent;
          reviewTextInput.value = box.querySelector("p").textContent;
          formContainer.classList.remove("hidden");
        });
      }

      if (deleteBtn) {
        deleteBtn.addEventListener("click", async () => {
          if (confirm("Do you want to delete this comment?")) {
            try {
              const token = localStorage.getItem("token");
              await fetch(
                `http://localhost:5000/api/v2/comment/${box.dataset.id}`,
                {
                  method: "DELETE",
                  headers: {
                    Authorization: `Bearer ${token}`,
                  },
                }
              );
              box.remove();
            } catch (err) {
              console.error("Failed to delete comment:", err);
            }
          }
        });
      }
    }

    addBtn.addEventListener("click", () => {
      editingId = null;
      reviewForm.reset();
      formContainer.classList.remove("hidden");
    });

    cancelBtn.addEventListener("click", () => {
      formContainer.classList.add("hidden");
    });

    reviewForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = reviewerNameInput.value.trim();
      const text = reviewTextInput.value.trim();
      const token = localStorage.getItem("token");

      try {
        if (editingId) {
          await fetch(`http://localhost:5000/api/v2/comment/${editingId}`, {
            method: "PUT",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ name, comment: text }),
          });
        } else {
          await fetch("http://localhost:5000/api/v2/comment", {
            method: "POST",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ name, comment: text }),
          });
        }

        formContainer.classList.add("hidden");
        fetchApiReviews();
      } catch (err) {
        console.error("Failed to save comment:", err);
      }
    });

    window.addEventListener("DOMContentLoaded", fetchApiReviews);
  </script>
  <script src="./javaesecript.js"></script>
</html>
